<html xmlns:tal="http://xml.zope.org/namespaces/tal">
<?python
    from plone import api
    portal_url = api.portal.get().absolute_url()
?>
<link rel="stylesheet" href="${portal_url}/++plone++MarieClaire.content/table.css">

<body>
    <table tal:condition="view/select_table">
        <tal:define define="data view/tableData">
            <?python keys = data.keys() ?>
            <tr>
                <th colspan="2" class="dfp_table_title dfp_red">Media/channel</th>
                <th class="dfp_table_title dfp_red">Period</th>
                <th class="dfp_table_title dfp_beide">Est,Imp</th>
                <th class="dfp_table_title dfp_beide">Est,CTR</th>
                <th class="dfp_table_title dfp_beide">Est,Clikcs</th>
                <th class="dfp_table_title dfp_yellow">Imps Delivery</th>
                <th class="dfp_table_title dfp_yellow">Imps Achievement</th>
                <th class="dfp_table_title dfp_yellow">Clicks</th>
                <th class="dfp_table_title dfp_yellow">CTR</th>
            </tr>
            <tr>
                <th colspan="2"></th>
                <th></th>
                <th>${view/Est_imp}</th>
                <th>${python:'%s %%' %round(float(view.Est_clk) / float(view.Est_imp)*100,2)}</th>
                <th>${view/Est_clk}</th>
                <th>${view/delivery_imp}</th>
                <th>${python:'%s %%'%round(float(view.delivery_imp) / float(view.Est_imp)*100,2)}</th>
                <th>${view/delivery_clk}</th>
                <th>${python:'%s %%' %round(float(float(view.delivery_clk) / float(view.delivery_imp)*100),2)}</th>
            </tr>
            <tr tal:repeat="key keys">
                <td class="pd5 dfp_grey">${python:data[key][0][0]}</td>
                <td class="pd5 dfp_grey">${python:data[key][0][1]}</td>
                <td class="pd5 dfp_grey">${python:data[key][0][2]}</td>
                <td class="pd5">${python:data[key][4][0]}</td>
                <td class="pd5">${python:'%s %%' %data[key][5][0]}</td>
                <td class="pd5">${python:int(int(data[key][4][0])*float(data[key][5][0])/100)}</td>
                <td class="pd5 dfp_grey">${python:data[key][1][0]}</td>
                <td class="pd5 dfp_grey">${python:'%s %%'% round(float(float(data[key][1][0])/float(data[key][4][0]))*100,2)}</td>
                <td class="pd5 dfp_grey">${python:data[key][2][0]}</td>
                <td class="pd5 dfp_grey">${python:'%s %%' %round(float(data[key][2][0])/float(data[key][1][0])*100,2)}</td>
            </tr>
        </tal:define>
    </table>

    <table tal:condition="view/select_detail">
        <tr>
            <th></th>
            <tal:repeat repeat="title view/day_title">
                <th colspan="3" class="dfp_table_title">${python:title.split('_')[0]}</th>
            </tal:repeat>
        </tr>
        <tr>
            <th></th>
            <tal:repeat repeat="title view/day_title">
                <th colspan="3" class="dfp_table_title">${python:title.split('_')[1]}</th>
            </tal:repeat>
        </tr>
        <tr>
            <th></th>
            <tal:repeat repeat="title view/day_title">
                <th colspan="3" class="dfp_table_title">${python:title.split('_')[2]}</th>
            </tal:repeat>
        </tr>
        <tr>
            <th></th>
            <tal:repeat repeat="title python:view.day_title">
                <th class="pd5">Impression</th>
                <th class="pd5">Clicks</th>
                <th class="pd5">CTR</th>
            </tal:repeat>
        </tr>

        <tr>
            <th class="pd5">購買曝光數</th>
            <th tal:repeat="est python:view.est" class="pd5 text-align-ri">${est}</th>
        </tr>

        <tr tal:define="day_data view/result_day_data"
            tal:repeat="day view/day_list">
            <th class="pd5">${python:day}</th>
            <tal:repeat repeat="index python:range(0, len(view.day_title)*3)">
                <td class="pd5 text-align-ri"
                    style="${python:'background-color:#CCC' if day_data[day][index]!='' else ''}">
                    ${python:day_data[day][index]}
                </td>
            </tal:repeat>
        </tr>
        <tr>
            <th class="pd5">總和</th>
            <th tal:repeat="sum view/sum_list" class="pd5 text-align-ri">${sum}</th>
        </tr>
        <tr>
            <th class="pd5">達成率</th>
            <th colspan="3" tal:repeat="rate view/reaching_rate" class="pd5 text-align-cen">${rate}</th>
        </tr>
    </table>
</body>
</html>